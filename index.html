<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sahil — Exam Q&A</title>
  <style>
    :root {
      --bg: #1b1e23;
      --text: #e6e0d8;
      --muted: #a8b0b7;
      --accent: #58c1aa;
      --accent2: #6fb3e5;
      --card-bg: #23272f;
      --card-border: #333842;
      --radius: 14px;
      --shadow: 0 4px 14px rgba(0,0,0,0.25);
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Inter', sans-serif;
      line-height: 2;
      padding: 0;
      margin: 0;
      font-size: 19px;
    }

    .container {
      max-width: 100%;
      padding: 1rem 2rem;
      box-sizing: border-box;
    }

    header {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      margin-bottom: 2rem;
    }

    header .brand {
      font-size: 2rem;
      font-weight: 900;
      color: var(--accent);
      margin-bottom: 0.3rem;
      letter-spacing: 1px;
    }

    header h1 {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--accent2);
      margin-bottom: 0.8rem;
    }

    header .name {
      font-size: 0.95rem;
      color: var(--muted);
      font-weight: 500;
      margin-bottom: 0.5rem;
    }

    header button {
      padding: 0.8rem 1.5rem;
      border-radius: var(--radius);
      background: var(--accent);
      color: var(--bg);
      font-weight: bold;
      border: none;
      cursor: pointer;
    }

    header button:hover {
      background: #6dd9c0;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .controls input,
    .controls select {
      flex: 1;
      min-width: 200px;
      padding: 0.85rem 1.2rem;
      font-size: 1rem;
      border-radius: var(--radius);
      border: 1px solid var(--card-border);
      background: var(--card-bg);
      color: var(--text);
    }

    .controls input:focus,
    .controls select:focus {
      border-color: var(--accent);
      outline: none;
    }

    .grid {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .question-answer-block {
      background: var(--card-bg);
      padding: 1.8rem;
      border-radius: var(--radius);
      border: 1px solid var(--card-border);
      box-shadow: var(--shadow);
      width: 100%;
      box-sizing: border-box;
    }

    .question {
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: 0.6rem;
      color: var(--accent2);
    }

    .answer {
      font-size: 1.05rem;
      color: var(--text);
      white-space: pre-wrap;
      word-wrap: break-word;
      padding: 0.5rem 0;
    }

    footer {
      margin-top: 3rem;
      text-align: center;
      font-size: 0.9rem;
      color: var(--muted);
      font-weight: 500;
      border-top: 1px solid #333842;
      padding: 1rem 0;
    }

    @media (max-width:768px) {
      body { font-size:18px; }
      .question { font-size:1.2rem; }
      .answer { font-size:1rem; }
    }

    @media (max-width:480px) {
      .container { padding: 1rem; }
    }
  </style>
</head>
<body>

<div class="container">
  <header>
    <div class="brand">SAHILCODELAB</div>
    <h1>Exam Q&A</h1>
    <div class="name">Powered by AI • SRGPT</div>
    <button id="copyAll">Copy All Answers</button>
  </header>

  <div class="controls">
    <input type="text" id="searchBox" placeholder="Search…">
    <select id="subjectSelect"><option value="">All Subjects</option></select>
    <div class="count" id="count">Loading…</div>
  </div>

  <div class="grid" id="grid"></div>

  <footer>© 2025 Sahil. All rights reserved.</footer>
</div>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT4UrGAH6zVI_MOAtuuK1PFMkHItUS6Xo3xcux3qxhy-7iVwiqNnCEs4oGmxaF6-R4vya-Y-p3wpt1p/pub?gid=0&single=true&output=csv";

async function loadCSV(url) {
  const res = await fetch(url);
  const text = await res.text();
  
  // Improved CSV parsing that handles quoted fields with line breaks
  const rows = [];
  let currentRow = [];
  let inQuotedField = false;
  let fieldValue = '';
  
  for (let i = 0; i < text.length; i++) {
    const char = text[i];
    
    if (char === '"') {
      inQuotedField = !inQuotedField;
      continue;
    }
    
    if (!inQuotedField && char === '\n') {
      if (fieldValue) currentRow.push(fieldValue);
      if (currentRow.length > 0) rows.push(currentRow);
      currentRow = [];
      fieldValue = '';
      continue;
    }
    
    if (!inQuotedField && char === ',') {
      currentRow.push(fieldValue);
      fieldValue = '';
      continue;
    }
    
    fieldValue += char;
  }
  
  // Add the last row if exists
  if (fieldValue) currentRow.push(fieldValue);
  if (currentRow.length > 0) rows.push(currentRow);
  
  const headers = rows.shift().map(h => h.trim());
  return rows.map(row => {
    const obj = {};
    headers.forEach((h, i) => {
      obj[h] = (row[i] || "").trim();
    });
    return obj;
  });
}

function sanitizeText(text) {
  // Preserve line breaks and clean up any CSV artifacts
  return text
    .replace(/""/g, '"') // Unescape double quotes
    .replace(/\r?\n/g, '<br>') // Convert line breaks to HTML
    .replace(/<br><br>/g, '<br><br>'); // Maintain paragraph spacing
}

const state = { all: [], filtered: [] };
const grid = document.getElementById("grid");
const searchBox = document.getElementById("searchBox");
const subjectSelect = document.getElementById("subjectSelect");
const countEl = document.getElementById("count");
const copyBtn = document.getElementById("copyAll");

function render(list) {
  grid.innerHTML = list.map(item => `
    <div class="question-answer-block">
      ${item.Subject ? `<div class="subject">${item.Subject}</div>` : ""}
      <div class="question">
        ${item.Question} ${item.Marks ? `(${item.Marks} marks)` : ""}
      </div>
      <div class="answer">${sanitizeText(item.Answer)}</div>
    </div>
  `).join("");
  countEl.textContent = `${list.length} of ${state.all.length}`;
}

function applyFilter() {
  const q = searchBox.value.toLowerCase();
  const s = subjectSelect.value;
  state.filtered = state.all.filter(item => {
    const matchSubj = !s || item.Subject === s;
    const blob = (item.Subject + " " + item.Question + " " + item.Answer).toLowerCase();
    const matchSearch = !q || blob.includes(q);
    return matchSubj && matchSearch;
  });
  render(state.filtered);
}

copyBtn.addEventListener("click", () => {
  const text = state.filtered.map(i => `Q: ${i.Question}\nA: ${i.Answer.replace(/<br>/g, '\n')}`).join("\n\n");
  navigator.clipboard.writeText(text);
  copyBtn.textContent = "Copied!";
  setTimeout(() => copyBtn.textContent = "Copy All Answers", 1000);
});

searchBox.addEventListener("input", applyFilter);
subjectSelect.addEventListener("change", applyFilter);

(async () => {
  state.all = await loadCSV(CSV_URL);
  const subs = [...new Set(state.all.map(i => i.Subject).filter(s => s))].sort();
  subs.forEach(s => subjectSelect.appendChild(new Option(s, s)));
  applyFilter();
})();
</script>

</body>
</html>